#!/bin/bash -x

load-env-ghc784 start-hackage
diskutil unmount /Volumes/Hackage

rsync -av --delete --exclude='*.ddictateprofile4' \
      ~/Documents/ ~/Dropbox/Documents/
rsync -av --delete --delete-excluded --exclude=dist/ \
      ~/Projects/ ~/Dropbox/Projects/

#(syncall; syncall; syncall) &
(sudo cleanup -u; sudo cleanup -u; sudo cleanup -u) &
pushme &
#nix-copy-closure --to hermes $(readlink -f ~/.nix-profile) &
update -a &
wait

~/Messages/manage-mail/remove-all-dups

pushall

ssh titan rsync -av --delete --exclude '/Backup*' \
    /tank/Data/Databases/Haskell.dtBase2/ /tank/Public/Haskell.dtBase2/

echo "Backup completed successfully."
