#!/bin/bash

pushme mybook
pushme hermes

sudo $HOME/bin/zfs-snapshot daily mybook
sudo $HOME/bin/zfs-snapshot day_of_week mybook
sudo $HOME/bin/zfs-snapshot weekly mybook
sudo $HOME/bin/zfs-snapshot monthly mybook
sudo $HOME/bin/zfs-snapshot yearly mybook

if [[ -d /Volumes/backup/Backups ]]; then
    sudo $HOME/bin/zfs-snapshot daily backup
    sudo $HOME/bin/zfs-snapshot day_of_week backup
    sudo $HOME/bin/zfs-snapshot weekly backup
    sudo $HOME/bin/zfs-snapshot monthly backup
    sudo $HOME/bin/zfs-snapshot yearly backup

    volcopy -av --delete /Volumes/mybook/Backups/Misc/    /Volumes/backup/Backups/Misc/
    volcopy -av --delete /Volumes/mybook/Backups/Servers/ /Volumes/backup/Backups/Servers/
    volcopy -av --delete /Volumes/mybook/Databases/       /Volumes/backup/Databases/
    volcopy -av --delete /Volumes/mybook/Games/           /Volumes/backup/Games/
    volcopy -av --delete /Volumes/mybook/Machines/        /Volumes/backup/Machines/
    volcopy -av --delete /Volumes/mybook/Media/           /Volumes/backup/Media/
    volcopy -av --delete /Volumes/mybook/Nasim/           /Volumes/backup/Nasim/
    volcopy -av --delete /Volumes/mybook/Photos/          /Volumes/backup/Photos/
    volcopy -av --delete /Volumes/mybook/Rentals/         /Volumes/backup/Rentals/
fi

~/Messages/manage-mail/remove-all-dups

# update -a

update-nix -a -p --leq -Q -j4

b2-sync 400

echo "Backup completed"
