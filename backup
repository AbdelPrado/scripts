#!/bin/bash

function monitor() {
    label="$1"
    shift 1
    echo "$@"
    /usr/bin/time eval "$@"                     \
        > ~/Library/Logs/${label}.log 2>&1      \
        || echo "$label failed"
}

if quickping $HERMES_ETHERNET; then
    monitor "push-hermes" push hermes
fi

if [[ -d /Volumes/tank/src/pushme ]]; then
    monitor "push-tank" push tank
    monitor "b2-restic" b2-restic /Volumes/tank tank
fi

monitor "reindex-mail" reindex-mail

#if [[ ! -d ~/.local/share/recoll/xapiandb ]]; then
#    mkdir -p ~/.local/share/recoll/xapiandb
#fi
#monitor "recollindex" recollindex -z

monitor "update-dfinity" update ~/dfinity
monitor "update-kadena"  update ~/kadena
monitor "update-src"     update ~/src

(cd ~/src/emacs;         monitor "emacs-pull"         git pull)
(cd ~/src/coq;           monitor "coq-pull"           git pull)
(cd ~/src/coq-equations; monitor "coq-equations-pull" git pull)
(cd ~/src/coq-tools;     monitor "coq-tools-pull"     git pull)
(cd ~/src/proof-general; monitor "proof-general-pull" git pull)

monitor "update-sync" u vulcan update-sync

monitor "travel-ready" travel-ready
