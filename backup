#!/bin/bash -x

(load-env-ghc783 start-hackage; diskutil unmount /Volumes/Hackage)

update-nix -Q -j8 -k
update-nix -Q -k
update-nix -Q && rebuild

syncall &
pushme &
update -a &
rsync -Hav --delete ~/Documents/ ~/Dropbox/Documents/ &

wait

pushall

ssh titan rsync -av --delete --exclude '/Backup*' \
    /tank/Data/Databases/Haskell.dtBase2/ /tank/Public/Haskell.dtBase2/ &

echo "Backup completed successfully."

wait

exit 0
