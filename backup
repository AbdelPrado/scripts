#!/bin/bash

function monitor() {
    label="$1"
    shift 1
    echo "$label"
    /usr/bin/time "$@"                          \
        > ~/Library/Logs/${label}.log 2>&1      \
        || echo "$label FAILED!"
}

if quickping $HERMES_ETHERNET; then
    monitor "push-hermes" push hermes
fi

if [[ -d /Volumes/tank/src/pushme ]]; then
    monitor "push-tank" push tank
    monitor "b2-restic" b2-restic /Volumes/tank tank
fi

monitor "reindex-mail" reindex-mail

#if [[ ! -d ~/.local/share/recoll/xapiandb ]]; then
#    mkdir -p ~/.local/share/recoll/xapiandb
#fi
#monitor "recollindex" recollindex -z

monitor "update-kadena"  update ~/kadena
monitor "update-src"     update ~/src

if quickping $HERMES_ETHERNET; then
    monitor "nix-update" u vulcan update-sync
else
    monitor "nix-update" u vulcan update
fi

monitor "travel-ready" travel-ready

if quickping $HERMES_ETHERNET; then
    monitor "nix-check-all" u vulcan check-all
else
    monitor "nix-check" u vulcan check
fi
