#!/bin/bash

set -e

if [[ -n "$1" ]]; then
    ROOT=$HOME/Contracts/Embarcadero/Projects/branches/$1
else
    ROOT=$HOME/Contracts/Embarcadero/Projects/llvm
fi

if [[ $(basename "$ROOT") == llvm ]]; then
    PRODUCTS=$HOME/Products/embt/main
else
    PRODUCTS=$HOME/Products/embt/$(basename "$ROOT")
fi
cd "$PRODUCTS"

if [[ $rebuild == true || ! -f "$PRODUCTS/Makefile" ]]; then
    /bin/rm -fr *
    nice -n 20 cmake                                            \
        -DCMAKE_BUILD_TYPE:=Debug                               \
        -DLLVM_TARGETS_TO_BUILD:=X86                            \
        -DCMAKE_INSTALL_PREFIX:PATH=/usr/local/stow/clang       \
        $ROOT
fi

exit 0

### clangup-clean ends here
