#!/bin/bash -x

NIX_FLAGS="-k -Q -j8 --show-trace"

find ~/ -name result -type l -delete
find ~/ -name Setup -type f -delete
find ~/ -name dist -type f -delete

cd ~/src/hours
nix-cabal-build $NIX_FLAGS

# cd ~/bae/crash
# nix-build $NIX_FLAGS -A crashEnv

cd ~/doc/newartisans
nix-cabal-build $NIX_FLAGS

for j in haskell-ng.packages.ghc784
do
    for i in                                    \
        $j.bugs                                 \
        $j.consistent                           \
        $j.find-conduit                         \
        $j.simple-conduit_HEAD                  \
        $j.async-pool                           \
        $j.git-all                              \
        $j.fuzzcheck                            \
        $j.hnix                                 \
        $j.hours                                \
        $j.logging_HEAD                         \
        $j.pushme                               \
        $j.simple-mirror                        \
        $j.gitlib                               \
        $j.hlibgit2                             \
        $j.git-monitor                          \
        $j.c2hsc
    do
        nix-shell ~/src/nixpkgs $NIX_FLAGS -A pkgs.$i --pure --command exit
    done
done

for i in ledger
do
    nix-shell ~/src/nixpkgs $NIX_FLAGS -A pkgs.$i --pure --command exit
done
